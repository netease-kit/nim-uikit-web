<!-- è½¬å‘å¼¹çª—é®ç½© -->
<view class="forward-modal-mask" wx:if="{{visible}}" bindtap="handleMaskClick">
  <!-- è½¬å‘å¼¹çª—å†…å®¹ -->
  <view class="forward-modal" catchtap="stopPropagation">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="modal-header">
      <view class="header-title">é€‰æ‹©è½¬å‘å¯¹è±¡</view>
      <view class="header-close" bindtap="handleClose">
        <icon type="close" size="20" color="#666" />
      </view>
    </view>
    
    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="search-box">
        <icon type="search" size="16" color="#999" />
        <input 
          class="search-input"
          placeholder="æœç´¢è”ç³»äººæˆ–ç¾¤èŠ"
          value="{{searchText}}"
          bindinput="handleSearchInput"
          confirm-type="search"
          bindconfirm="handleSearch"
        />
        <view class="search-clear" wx:if="{{searchText}}" bindtap="handleClearSearch">
          <icon type="close" size="14" color="#999" />
        </view>
      </view>
    </view>
    
    <!-- æœ€è¿‘è”ç³»äºº -->
    <view class="recent-section" wx:if="{{recentContacts.length > 0 && !searchText}}">
      <view class="section-title">æœ€è¿‘è”ç³»äºº</view>
      <scroll-view class="recent-list" scroll-x="{{true}}" show-scrollbar="{{false}}">
        <view 
          class="recent-item"
          wx:for="{{recentContacts}}"
          wx:key="id"
          wx:for-item="contact"
          bindtap="handleSelectContact"
          data-contact="{{contact}}"
        >
          <message-avatar 
            account="{{contact.id}}"
            avatar="{{contact.avatar}}"
            size="48"
          />
          <text class="recent-name">{{contact.name}}</text>
        </view>
      </scroll-view>
    </view>
    
    <!-- è”ç³»äººåˆ—è¡¨ -->
    <view class="contacts-section">
      <view class="section-title">{{searchText ? 'æœç´¢ç»“æœ' : 'å…¨éƒ¨è”ç³»äºº'}}</view>
      <scroll-view class="contacts-list" scroll-y="{{true}}">
        <!-- ç¾¤èŠåˆ—è¡¨ -->
        <view class="contact-group" wx:if="{{filteredTeams.length > 0}}">
          <view class="group-title">ç¾¤èŠ</view>
          <view 
            class="contact-item"
            wx:for="{{filteredTeams}}"
            wx:key="teamId"
            wx:for-item="team"
            bindtap="handleSelectContact"
            data-contact="{{team}}"
          >
            <message-avatar 
              account="{{team.teamId}}"
              avatar="{{team.avatar}}"
              size="40"
            />
            <view class="contact-info">
              <text class="contact-name">{{team.name}}</text>
              <text class="contact-desc">{{team.memberCount}}äºº</text>
            </view>
            <view class="contact-check" wx:if="{{team.selected}}">
              <icon type="check" size="16" color="#337eff" />
            </view>
          </view>
        </view>
        
        <!-- å¥½å‹åˆ—è¡¨ -->
        <view class="contact-group" wx:if="{{filteredFriends.length > 0}}">
          <view class="group-title">å¥½å‹</view>
          <view 
            class="contact-item"
            wx:for="{{filteredFriends}}"
            wx:key="userId"
            wx:for-item="friend"
            bindtap="handleSelectContact"
            data-contact="{{friend}}"
          >
            <message-avatar 
              account="{{friend.userId}}"
              avatar="{{friend.avatar}}"
              size="40"
            />
            <view class="contact-info">
              <text class="contact-name">{{friend.name}}</text>
              <text class="contact-desc">{{friend.signature || ''}}</text>
            </view>
            <view class="contact-check" wx:if="{{friend.selected}}">
              <icon type="check" size="16" color="#337eff" />
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{filteredTeams.length === 0 && filteredFriends.length === 0}}">
          <view class="empty-icon">ğŸ”</view>
          <view class="empty-text">{{searchText ? 'æœªæ‰¾åˆ°ç›¸å…³è”ç³»äºº' : 'æš‚æ— è”ç³»äºº'}}</view>
        </view>
      </scroll-view>
    </view>
    
    <!-- å·²é€‰æ‹©çš„è”ç³»äºº -->
    <view class="selected-section" wx:if="{{selectedContacts.length > 0}}">
      <view class="selected-title">å·²é€‰æ‹© ({{selectedContacts.length}})</view>
      <scroll-view class="selected-list" scroll-x="{{true}}" show-scrollbar="{{false}}">
        <view 
          class="selected-item"
          wx:for="{{selectedContacts}}"
          wx:key="id"
          wx:for-item="contact"
        >
          <view class="selected-avatar">
            <message-avatar 
              account="{{contact.id}}"
              avatar="{{contact.avatar}}"
              size="32"
            />
            <view class="selected-remove" bindtap="handleRemoveContact" data-contact="{{contact}}">
              <icon type="close" size="12" color="#fff" />
            </view>
          </view>
          <text class="selected-name">{{contact.name}}</text>
        </view>
      </scroll-view>
    </view>
    
    <!-- å¼¹çª—åº•éƒ¨ -->
    <view class="modal-footer">
      <view class="footer-cancel" bindtap="handleClose">
        å–æ¶ˆ
      </view>
      <view 
        class="footer-confirm {{selectedContacts.length > 0 ? 'active' : ''}}"
        bindtap="handleConfirm"
      >
        ç¡®å®š{{selectedContacts.length > 0 ? '(' + selectedContacts.length + ')' : ''}}
      </view>
    </view>
  </view>
</view>